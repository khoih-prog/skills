#!/bin/bash
# æ³¨å†Œå‘½ä»¤å¤„ç†
# /register <api_key>

CHAT_ID="$1"
API_KEY="$2"
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
USER_MANAGER="$SCRIPT_DIR/user-manager.sh"

# éªŒè¯ API Key æ ¼å¼
if [[ ! "$API_KEY" =~ ^sk-[a-zA-Z0-9]{20,}$ ]]; then
    cat << EOF
âš ï¸ API Key æ ¼å¼é”™è¯¯

æ ¼å¼è¦æ±‚ï¼š
â€¢ ä»¥ "sk-" å¼€å¤´
â€¢ åè·Ÿè‡³å°‘ 20 ä½å­—ç¬¦
â€¢ ä»…åŒ…å«å­—æ¯å’Œæ•°å­—

ç¤ºä¾‹ï¼šsk-random12345678901234567890

è¯·æ£€æŸ¥æ‚¨çš„ API Key å¹¶é‡æ–°è¾“å…¥ï¼š
/register sk-æ‚¨çš„Key
EOF
    exit 1
fi

# éªŒè¯ API Key æœ‰æ•ˆæ€§ï¼ˆå¯é€‰ï¼Œè°ƒç”¨ Cue æ¥å£æµ‹è¯•ï¼‰
# è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œç›´æ¥æ³¨å†Œ

# æ‰§è¡Œæ³¨å†Œ
$USER_MANAGER register "$CHAT_ID" "$API_KEY"

# è·å–æ›´æ–°åçš„é…é¢çŠ¶æ€
QUOTA_STATUS=$($USER_MANAGER quota "$CHAT_ID")

cat << EOF
âœ… æ³¨å†ŒæˆåŠŸï¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ‰ æ‚¨å·²å‡çº§ä¸ºæ³¨å†Œç”¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ API Key å·²ç»‘å®š
âœ“ ç‹¬ç«‹å·¥ä½œç©ºé—´å·²åˆ›å»º
âœ“ é…é¢é™åˆ¶å·²è§£é™¤

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æ‚¨çš„é…é¢çŠ¶æ€
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ æ·±åº¦ç ”ç©¶ï¼šæ— é™åˆ¶ï¼ˆä½¿ç”¨æ‚¨çš„ Keyï¼‰
â€¢ å¿«é€Ÿæœç´¢ï¼šæ— é™åˆ¶ï¼ˆä½¿ç”¨æ‚¨çš„ Keyï¼‰

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ å¼€å§‹ä½¿ç”¨
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ è¾“å…¥ç ”ç©¶ä¸»é¢˜ç›´æ¥å¼€å§‹
â€¢ ä½¿ç”¨ /usage æŸ¥çœ‹é…é¢
â€¢ ä½¿ç”¨ /help æŸ¥çœ‹å¸®åŠ©

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”” æç¤º
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ‚¨çš„ API Key ç”± Cue å¹³å°ç®¡ç†é…é¢
å¦‚æœ‰é—®é¢˜è¯·è”ç³» Cue å®˜æ–¹æ”¯æŒ

---
*ç”¨æˆ·ID: ${CHAT_ID:0:20}...*
EOF
